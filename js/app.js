let map;let vm;const Model={locations:[{content:"Forest Park is a park in the New York City borough of Queens. It has an area of 538 acres, containing 165 acres of trees. The park is operated and maintained by the New York City Department of Parks and Recreation.",location:{lat:40.7027,lng:-73.8493},title:'Forest Park Carasouel'},{content:"Retail chain offering home goods, clothing, electronics & more, plus exclusive designer collections.",location:{lat:40.7210,lng:-73.8478},title:'Target'},{content:"Carrot cake, chocolate mousse, gelato, marble yogurt pound cake, very berry napoleon, Oreo cupcake, frozen mixed drinks, hot chocolate, coffee…this is only the beginning of what meets the eyes upon entering the newly expanded Martha’s Country Bakery in Forest Hills.",location:{lat:40.7203,lng:-73.8460},title:'Marthas Bakery'},{content:'Contemporary, brick-walled restaurant & bar with Mediterranean fare & weekday happy-hour specials.',location:{lat:40.7208,lng:-73.8453},title:'The Grill'},{content:"Pahal Zan is a cornerstone in the Forest Hills community and has been recognized for its outstanding Mediterranean cuisine, excellent service and friendly staff.",location:{lat:40.7194,lng:-73.8452},title:'Pahal Zhan'}],markers:[]};function AppViewModel(marker){const self=this;self.createListings=ko.observableArray();self.activateMarker=function(currentItem){var marker=currentItem;google.maps.event.trigger(marker,'click')}}function initMap(){const forestHills={lat:40.7181,lng:-73.8448};vm=new AppViewModel();map=new google.maps.Map(document.getElementById('map'),{center:forestHills,mapTypeControl:false,styles:[{"elementType":"all","featureType":"administrative","stylers":[{"visibility":"on"},{"lightness":33}]},{"elementType":"all","featureType":"landscape","stylers":[{"color":"#f2e5d4"}]},{"elementType":"geometry","featureType":"poi.park","stylers":[{"color":"#c5dac6"}]},{"elementType":"labels","featureType":"poi.park","stylers":[{"visibility":"on"},{"lightness":20}]},{"elementType":"all","featureType":"road","stylers":[{"lightness":20}]},{"elementType":"geometry","featureType":"road.highway","stylers":[{"color":"#c5c6c6"}]},{"elementType":"geometry","featureType":"road.arterial","stylers":[{"color":"#e4d7c6"}]},{"elementType":"geometry","featureType":"road.local","stylers":[{"color":"#fbfaf7"}]},{"elementType":"all","featureType":"water","stylers":[{"visibility":"on"},{"color":"#acbcc9"}]}],zoom:15});function getFourSquare(){var client_id="ZBCPIT5VPYBTT2KNLCWMIJU4BAL4ANCO4MPJHLSJBOYB3D32";var client_secret='2K5DPY4FG2DN2ZX4JSTWXHUN140LMR1JHGE04YCXOU0P303P';var fourSquareUrl="https://api.foursquare.com/v2/venues/search?client_id="+client_id+"&client_secret="+client_secret+"&v=20160815&ll="+40.7181+","+-73.8448;$.ajax({dataType:'json',url:fourSquareUrl}).done(function(data){let foursquareResponse=data.response.venues;if(Model.markers.length===0){console.log('nothing in the marker');Model.markers.push(foursquareResponse)}for(let i=0;i<Model.markers[0].length;i+=1){createMarker(Model.markers[0][i].location,Model.markers[0][i].name,Model.markers[0][i].location.formattedAddress)}}).fail(function(){for(let i=0;i<Model.locations.length;i+=1){createMarker(Model.locations[i].location,Model.locations[i].title,Model.locations[i].content)}})}getFourSquare();function createMarker(location,name,formattedAddress){const streetViewURL='https://maps.googleapis.com/maps/api/streetview?size=300x300&location=';for(let i=0;i<Model.markers[0].length;i+=1){content='<div><img src="'+streetViewURL+formattedAddress+'"><div class="marker-title">'+name+'</div>'}let marker=new google.maps.Marker({animation:google.maps.Animation.DROP,content:content,icon:'http://maps.google.com/mapfiles/marker_yellow.png',map:map,position:location,title:name});vm.createListings.push(marker);let bounds=new google.maps.LatLngBounds();let infowindow=new google.maps.InfoWindow({});function markerAnimate(){marker.addListener('click',function(){if(this.getAnimation()!==null){this.setAnimation(null);this.setIcon('http://maps.google.com/mapfiles/marker_yellow.png');infowindow.close(map,this)}else{$(this).addClass('clickable');this.setAnimation(google.maps.Animation.BOUNCE);this.setIcon('http://maps.google.com/mapfiles/marker_purple.png');infowindow.setContent(this.content);infowindow.open(map,this);bounds.extend(this.position)}})}markerAnimate();$('.submitBtn').on('click',function(){marker.setMap(null);console.log('I cleared the old markers')})}let stringSearch;$('form').submit(function(e){e.preventDefault();let stringSearch=$('input').val();console.log(stringSearch);vm.createListings.removeAll();getPlaces(stringSearch);$('input').val('')});function getPlaces(stringSearch){let request={location:{lat:40.7194,lng:-73.8452},query:stringSearch,radius:'100'};service=new google.maps.places.PlacesService(map);service.textSearch(request,callback);function callback(results,status){if(status==google.maps.places.PlacesServiceStatus.OK){Model.markers=[];Model.markers.push(results);for(let i=0;i<results.length;i+=1){createMarker(results[i].geometry.location,results[i].name,results[i].formatted_address)}}}}ko.applyBindings(vm)}